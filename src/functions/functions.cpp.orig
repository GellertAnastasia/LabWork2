#include "functions.h"

void playCard(Player& player, Player& enemy, Field& field) {
    drawField(field, player, enemy);

    player.printInventory();

    std::cout << "Your choice: ";
    int choice;
    std::cin >> choice;
    drawField(field, player, enemy);
    int x,y;
    std::cout << "Write the coordinates: ";
    std::cin >> x >> y;
    field.addCharacter(player, std::make_shared<Coordinates>(x,y), player.inventory[choice-1]);
    //player.mana -= 1;
    player.inventory.erase(player.inventory.begin() + choice-1);
    drawField(field, player, enemy);
    player.printInventory();
}

void moveCharacter(int choice, Player& player, Player& enemy, Field& field) {
    drawField(field, player, enemy);
    std::cout << "Choose the coordinates:\n";
    player.charactersOnGrid[choice-1]->calculateMovement(player.location[choice-1], field.full);
    player.charactersOnGrid[choice-1]->printMovement();
    int choice1;
    std::cin >> choice1;
    field.addCharacter(player, player.charactersOnGrid[choice-1]->movement[choice1-1], player.charactersOnGrid[choice-1]);
    player.charactersOnGrid[choice-1]->movement.clear();
    field.deleteObject(choice, player);
    drawField(field, player, enemy);
}

void attack(int choice, Player& player, Player& enemy, Field& field) {
    drawField(field, player, enemy);
    std::cout << "Choose the coordinates:\n";
    player.charactersOnGrid[choice-1]->calculateAttack(field.full, field.grid);
    player.charactersOnGrid[choice-1]->printAttack();
    int choice1;
    std::cin >> choice1;
    addHealth(player.charactersOnGrid[choice-1]->attack[choice1-1], -player.charactersOnGrid[choice-1]->power);
    if (player.charactersOnGrid[choice-1]->attack[choice1-1]->health <= 0) {
            for (int y = 1; y <= HEIGHT; y++) {
                for (int x = 1; x <= WIDTH; x++)
                if (field.grid[y-1][x-1] == player.charactersOnGrid[choice-1]->attack[choice1-1]) {
                field.full[y-1][x-1] = false;
                field.grid[y-1][x-1] = nullptr;
                }
                player.charactersOnGrid.erase(player.charactersOnGrid.begin() + choice-1);
                player.location.erase(player.location.begin() + choice-1);
            }
    }
    std::cout << player.charactersOnGrid[choice-1]->attack[choice1-1]->health << "\n";
    player.charactersOnGrid[choice-1]->attack.clear();
}

void pause() {
     std::cout << "Click Enter to continue...";
     std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
     std::cin.get();
}
